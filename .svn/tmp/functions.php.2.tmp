<?php
/**
 * Functions - Framework gatekeeper
 *
 * This file defines a few constants variables, loads up the core framework file, 
 * and finally initialises the main WP Framework Class.
 *
 * @package WPFramework
 * @subpackage Functions
 */

	define( 'WP_FRAMEWORK', '0.2.4' ); // Defines current version for WP Framework
	
	/* Blast you red baron! Initialise WP Framework */
	require_once( TEMPLATEPATH . '/library/framework.php' );
	WPFramework::init();
	

	function get_url($p){
		$p = get_page_by_title($p);
		return get_page_link($p->ID);
	}

	function spotlight($spot, $stats_in= array('university') ){
		global $stats;
		$stats = $stats_in;
		$path = TEMPLATEPATH . '/webcom/spotlights/spotlight-' . $spot . '.php';
		if(file_exists($path)){
			include($path);
		}
	}
	
	function get_video($id=null){
		if (!is_numeric($id)){
			$videos = get_posts(array(
				'post_type' => 'videos',
				'orderby'   => 'rand',
			));
			$video = (count($videos)) ? $videos[0] : null;
		}else{
			$video = get_post($id);
		}
		$video->youtube = get_post_meta($video->ID, "admissions_youtubeID", true);
		$video->desc    = get_post_meta($video->ID, "admissions_vid_description", true);
		$video->thumb   = get_the_post_thumbnail($video->ID, 'video-thumb');
		$JS             = JS;
		
		$html = <<<HTML
		<div class="video">
			<div class="icon">
				<a href="$JS/ajax/?youtube=$video->youtube">$video->thumb
				<a class="play" rel="#overlay"></a>
			</div>
			<h4>$video->post_title</h4>
			<p>$video->desc</p>
		</div>
HTML;
		return $html;
	}
	
	function get_video_scripts(){
		return <<<HTML
		<!-- videos -->
		<script src="$JS/jquery/plugins/jqueryTools.js" type="text/javascript"></script>
		<script src="$JS/jquery/plugins/carousel.js" type="text/javascript"></script>
		<script>
		$(function() {
			$(".video a[rel]").overlay({
				mask: '#333',
				effect: 'apple',
				onBeforeLoad: function() {
					var wrap = this.getOverlay().find(".contentWrap");
					wrap.load(this.getTrigger().siblings().attr("href"));
				}
			});
			$(".vid-car").carousel({ dispItems: 3, pagination:true } );
			$(".pub-car").carousel({ dispItems: 4, pagination:true } );
		});
		</script>
HTML;
	}
	
	function get_publication($id=null){
		if (!is_numeric($id)){
			$pubs = get_posts(array(
				'post_type' => 'publications',
				'orderby'   => 'rand',
			));
			$pub = (count($pubs)) ? $pubs[0] : null;
		}else{
			$pub = get_post($id);
		}
		$pub->url   = get_post_meta($pub->ID, "admissions_pub-url", true);
		$pub->thumb = get_the_post_thumbnail($pub->ID, 'publication-thumb');
		
		$html = <<<HTML
		<div class="pub">
			<a title="$pub->post_title" rel="shadowbox" href="$pub->url">$pub->thumb<span>$pub->post_title</span></a>
		</div>
HTML;
		return $html;
	}
	
	function get_publication_scripts(){
		return <<<HTML
		<!-- overlayed element -->
		<div class="apple_overlay" id="overlay">
			<!-- the external content is loaded inside this tag -->
			<div class="contentWrap"></div>
		</div>
		<!-- publications -->
		<script type="text/javascript" src="<?=JS?>/shadowbox/shadowbox.js"></script>
		<script type="text/javascript">
			Shadowbox.loadSkin('classic', '<?=JS?>/shadowbox/skin');
			window.onload = function(){
				Shadowbox.init();
			};
		</script>
HTML;
		
	}
	
	
	/* admin */
	include('webcom/custom-post-types.php');
<<<<<<< .mine
	include('webcom/templates/redirect.php');
	include('webcom/admin/options.php');
	include('webcom/admin/functions.php');=======
	include('webcom/widgets.php');
	
	/* front-end */
	include('webcom/templates/redirect.php');>>>>>>> .r317
