<?php
/**
 * Functions - Framework gatekeeper
 *
 * This file defines a few constants variables, loads up the core framework file, 
 * and finally initialises the main WP Framework Class.
 *
 * @package WPFramework
 * @subpackage Functions
 */

	define( 'WP_FRAMEWORK', '0.2.4' ); // Defines current version for WP Framework
	
	/* Blast you red baron! Initialise WP Framework */
	require_once( TEMPLATEPATH . '/library/framework.php' );
	WPFramework::init();
	

	function get_url($p){
		$p = get_page_by_title($p);
		return get_page_link($p->ID);
	}

	function spotlight($spot, $stats_in= array('university') ){
		global $stats;
		$stats = $stats_in;
		$path = TEMPLATEPATH . '/webcom/spotlights/spotlight-' . $spot . '.php';
		if(file_exists($path)){
			include($path);
		}
	}
	
	function get_video($id=null){
		if (!is_numeric($id)){
			$videos = get_posts(array(
				'post_type' => 'videos',
				'orderby'   => 'rand',
			));
			$video = (count($videos)) ? $videos[0] : null;
		}else{
			$video = get_post($id);
		}
		$video->youtube = get_post_meta($video->ID, "admissions_youtubeID", true);
		$video->desc    = get_post_meta($video->ID, "admissions_vid_description", true);
		$video->thumb   = get_the_post_thumbnail($video->ID, 'video-thumb');
		$JS             = JS;
		$onclick        = "onclick=\"_gaq.push(['_trackEvent','Admissions_Events','Play_video',"
							. "'Video:"  . sanitize_title_with_dashes($video->post_title)
							. " Page:" . sanitize_title_with_dashes( the_title('','',false) ) 
							. "'])\"";
		$html = <<<HTML
		<div class="video">
			<div class="icon">
				<a href="$JS/ajax/?youtube=$video->youtube" $onclick>$video->thumb</a>
				<a class="play" rel="#overlay"></a>
			</div>
			<h4>$video->post_title</h4>
			<p>$video->desc</p>
		</div>
HTML;
		return $html;
	}
	
	
	function get_publication($id=null){
		if (!is_numeric($id)){
			$pubs = get_posts(array(
				'post_type' => 'publications',
				'orderby'   => 'rand',
			));
			$pub = (count($pubs)) ? $pubs[0] : null;
		}else{
			$pub = get_post($id);
		}
		$pub->url   = get_post_meta($pub->ID, "admissions_pub-url", true);
		$pub->thumb = get_the_post_thumbnail($pub->ID, 'publication-thumb');
		$onclick    = "onclick=\"_gaq.push(['_trackEvent','Admissions_Events','View_Pub',"
							. "'Pub:"  . sanitize_title_with_dashes($pub->post_title)
							. " Page:" . sanitize_title_with_dashes( the_title('','',false) ) 
							. "'])\"";
		
		$html = <<<HTML
		<div class="pub">
			<a title="$pub->post_title" rel="shadowbox" href="$pub->url" $onclick>$pub->thumb<span>$pub->post_title</span></a>
		</div>
HTML;
		return $html;
	}
	
	
	/* admin */
	include('webcom/custom-post-types.php');
	include('webcom/widgets.php');
	include('webcom/admin/options.php');
	include('webcom/admin/functions.php');
	
	/* front-end */
	include('webcom/templates/redirect.php');